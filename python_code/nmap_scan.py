import nmap 
import optparse

def nmap_scan(tgt_host, tgt_port):
    nm_scanner = nmap.PortScanner()
    nm_scanner.scan(tgt_host, tgt_port) 
    state=nm_scanner[str(tgt_host)]['tcp'][int(tgt_port)]['state']
    print " [*] " + tgt_host + " tcp/" + tgt_port + " " + state


def main ():

    # Parse command line options
    parser = optparse.OptionParser("usage %prog -H <target host> -p <target port>")
    parser.add_option("-H", dest='tgtHost', type='string', help='specify target host')
    parser.add_option('-p', dest='tgtPort', type='string', help='specify target port[s] separated by comma')
    
    (options, args) = parser.parse_args()
    tgtHost = options.tgtHost
    tgtPorts = str(options.tgtPort).split(',') 

    if (tgtHost == None) or (tgtPorts[0] == None):
        print parser.usage
        exit(0)

    for tgtPort in tgtPorts:
        nmap_scan(tgtHost, tgtPort)


if __name__ == '__main__':
    main()


